<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Интерактивная карта</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <script src="https://api-maps.yandex.ru/2.1/?apikey={{ yandex_maps_api_key }}&lang=ru_RU" type="text/javascript"></script>
    <style>
        #map {
            width: 100%;
            height: 600px;
            margin: 0;
            padding: 0;
        }
        .left-panel {
            width: 70%;
            padding: 20px;
        }
        .right-panel {
            width: 30%;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Левая панель -->
        <div class="left-panel">
            <!-- Поиск -->
            <div class="search-bar">
                <input type="text" placeholder="Поиск" />
            </div>
            <div class="map-name">
                Наименование текущей карты
            </div>
            <!-- Контейнер для карты -->
            <div id="map"></div>
        </div>

        <!-- Правая панель -->
        <div class="right-panel">
            <div class="MapTitleBox">
                <h2 class="map-title">Наименование карты</h2>
            </div>
            <div class="RightPanelContainer">
                <!-- Слои, настройки, и т.д. -->
            </div>
            <div class="auth-section">
                {% if user.is_authenticated %}
                    <p>Добро пожаловать, {{ user.username }}!</p>
                    <button class="logout-button" onclick="window.location.href='{% url 'users:logout' %}'">
                        Выйти
                    </button>
                {% else %}
                    <button class="auth-button" onclick="window.location.href='{% url 'users:login' %}'">
                        Авторизация
                    </button>
                    <p>
                        <a class="register-hint" href="{% url 'users:register' %}">Нет аккаунта?</a>
                    </p>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
    ymaps.ready(function () {
        {% if geojson_data %}
            var geoJsonData = {{ geojson_data|safe }};
            
            // Создаем карту
            var map = new ymaps.Map('map', {
                center: [52.06, 113.52],
                zoom: 15,
                controls: ['zoomControl', 'typeSelector', 'searchControl']
            });

            // Преобразуем GeoJSON в объекты Яндекс.Карт
            var geoObjects = ymaps.geoQuery(geoJsonData).addToMap(map);

            // Устанавливаем границы карты по добавленным объектам
            var bounds = geoObjects.getBounds();
            if (bounds) {
                map.setBounds(bounds, {
                    checkZoomRange: true,
                    zoomMargin: 50
                });
            }

        {% else %}
            console.error('GeoJSON data not available');
            // Показываем пустую карту
            var map = new ymaps.Map('map', {
                center: [52.06, 113.52],
                zoom: 15,
                controls: ['zoomControl', 'typeSelector', 'searchControl']
            });
        {% endif %}
    });
    </script>

    <script>
    console.log("API ключ:", "{{ yandex_maps_api_key }}");
    console.log("GeoJSON данные:", {% if geojson_data %}{{ geojson_data|safe }}{% else %}null{% endif %});
</script>

</body>
</html>